# Dockerfile for React UI
# Exemple avec multistaging : node + nginx
# Etape 1 contruire l'application avec node
FROM node AS build

# Define the working directory
WORKDIR /usr/src/app

# Copy package.json and install dependencies
COPY ./client/package.json ./
# COPY package-lock.json .

RUN yarn install

# Copy the rest of the application files
COPY . .

# Build the React application
RUN yarn run build


# Etape 2 : deployer l'application build sur un serveur nginx
FROM nginx:alpine

RUN rm -rf /usr/share/nginx/html/*

# Copier le build de mon application react a partir de l'etape precedente dans le repertoire nginx 
COPY --from=build /usr/src/app/build /usr/share/nginx/html

# Expose the port used by React (from .env: 3000)
EXPOSE 3000

# Start the application using serve (or any other server you prefer)
CMD ["npx", "serve", "-s", "build", "-l", "3000"]
#CMD ["nginx","-g","daemon off;"]









